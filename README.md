# scPopCorn
A python tool to do comparative analysis of mulitple single cell datasets.

# Installation
```bash
$ pip install scpopcorn
```

# Input scRNA-seq Data File Format
scPopCorn needs multiple single cell RNA-seq dataset as inputs. Bascially, the format looks like the following. Example data files can be found in the ```Data``` folder.

| Cell1ID | Cell2ID | Cell3ID | Cell4ID | Cell5ID  | ... |
|----|--------|--------|--------|---------|-----|
| Gene1 | 12 | 0 | 0 | 0 | ... |
| Gene2 | 125 | 0 | 298 | 0  | ... |
| Gene3 | 0 | 0| 0 | 0  | ... |
|...    |...|...|...|...|...|

The gourd truth labels for cells in each dataset can also be input. The format is as following

| Cell1ID | Lable1 |
|----|--------|
| Cell1ID | Lable2 |
| Cell1ID | Lable3 |
| Cell1ID | Lable4 |
|...    |..


# How to use

## import scpopcorn package
```
from scpopcorn import MergeSingleCell
from scpopcorn import SingleCellData
```

## read in RNA-seq datasets
```
File1 = "../Data/Human&Mouse_Pancreas/pancreas_human.expressionMatrix.txt"
Test1 = SingleCellData()
Test1.ReadData_SeuratFormat(File1)

File2 = "../Data/Human&Mouse_Pancreas/pancreas_mouse.expressionMatrix.txt"
Test2 = SingleCellData()
Test2.ReadData_SeuratFormat(File2)
```

## read in ground truth cell labels (this is optional)
```
File1T = "../Data/Human&Mouse_Pancreas/pancreas_human.CellLabels.txt"
Test1.ReadTurth(File1T, 0, 1)

File2T = "../Data/Human&Mouse_Pancreas/pancreas_mouse.CellLabels.txt"
Test2.ReadTurth(File2T, 0, 1)
```

## normlize counts data, find highly vaiable genes, and natural logarithm of one plus of the counts data
```
Test1.Normalized_per_Cell()
Test1.FindHVG()
Test1.Log1P()

Test2.Normalized_per_Cell()
Test2.FindHVG()
Test2.Log1P()
```

## combine datasets and set number of supercells for each dataset
```
NumSuperCell_Test1 = 50
NumSuperCell_Test2 = 50
MSingle = MergeSingleCell(Test1, Test2)
MSingle.MultiDefineSuperCell(NumSuperCell_Test1,NumSuperCell_Test2)
```
In this example, we define 50 supercells for each dataset.

## compute co-membership graph within each dataset and similarity matrix across dataset
```
MSingle.ConstructWithinSimiarlityMat_SuperCellLevel()
MSingle.ConstructBetweenSimiarlityMat_SuperCellLevel()
```

## run joint partition 
```
Estimate_NumCluster = 10 # initial guess of number of corresponding clusters, do not need to be accurate!!!
MSingle.SDP_NKcut(Estimate_NumCluster)
```
```Estimate_NumCluster``` is the initial guess of the number of sub-populations you want to find and it is just an approxiamtion.

## rounding the results
```
NumCluster_Min = 3 
NumCluster_Max = 20
CResult = MSingle.NKcut_Rounding(NumCluster_Min, NumCluster_Max)
```
scPopCorn will screen number of clusters from ```NumCluster_Min``` to ```NumCluster_Max``` and automatically find the best number of clusters in ```[NumCluster_Min, NumCluster_Max]```

## evaluate of clustering results using ground truth (this is optional)
```
MSingle.Evaluation(CResult)
```

## similairty between cell subpopulations across datasets
```
MSingle.StatResult()
```

## Umap plots using the results generated by scPopCorn
```
MSingle.Umap_Result()
```

## Ouptput the results
```
MSingle.OutputResult("TestOut.txt")
```
Output results in the "TestOut.txt" file.


# Examples and reproducible results 
Jupypter notebooks of examples are provide in Reproduce folder!!!

